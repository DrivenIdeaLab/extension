var ye=Object.defineProperty;var ve=(e,t,l)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l;var W=(e,t,l)=>(ve(e,typeof t!="symbol"?t+"":t,l),l);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function l(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=l(o);fetch(o.href,r)}})();function T(){}function de(e){return e()}function Y(){return Object.create(null)}function A(e){e.forEach(de)}function ce(e){return typeof e=="function"}function ae(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function be(e){return Object.keys(e).length===0}function w(e,t){e.appendChild(t)}function j(e,t,l){e.insertBefore(t,l||null)}function O(e){e.parentNode&&e.parentNode.removeChild(e)}function ke(e,t){for(let l=0;l<e.length;l+=1)e[l]&&e[l].d(t)}function p(e){return document.createElement(e)}function J(e){return document.createTextNode(e)}function C(){return J(" ")}function xe(){return J("")}function S(e,t,l,n){return e.addEventListener(t,l,n),()=>e.removeEventListener(t,l,n)}function a(e,t,l){l==null?e.removeAttribute(t):e.getAttribute(t)!==l&&e.setAttribute(t,l)}function Se(e){return Array.from(e.childNodes)}function Ce(e,t){t=""+t,e.data!==t&&(e.data=t)}function M(e,t){e.value=t??""}function Q(e,t,l){for(let n=0;n<e.options.length;n+=1){const o=e.options[n];if(o.__value===t){o.selected=!0;return}}(!l||t!==void 0)&&(e.selectedIndex=-1)}function Ee(e){const t=e.querySelector(":checked");return t&&t.__value}let B;function N(e){B=e}function Me(){if(!B)throw new Error("Function called outside component initialization");return B}function Oe(e){Me().$$.on_mount.push(e)}const $=[],X=[];let L=[];const ee=[],je=Promise.resolve();let F=!1;function Ie(){F||(F=!0,je.then(ue))}function D(e){L.push(e)}const Z=new Set;let I=0;function ue(){if(I!==0)return;const e=B;do{try{for(;I<$.length;){const t=$[I];I++,N(t),$e(t.$$)}}catch(t){throw $.length=0,I=0,t}for(N(null),$.length=0,I=0;X.length;)X.pop()();for(let t=0;t<L.length;t+=1){const l=L[t];Z.has(l)||(Z.add(l),l())}L.length=0}while($.length);for(;ee.length;)ee.pop()();F=!1,Z.clear(),N(e)}function $e(e){if(e.fragment!==null){e.update(),A(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(D)}}function Le(e){const t=[],l=[];L.forEach(n=>e.indexOf(n)===-1?t.push(n):l.push(n)),l.forEach(n=>n()),L=t}const q=new Set;let Te;function fe(e,t){e&&e.i&&(q.delete(e),e.i(t))}function Ae(e,t,l,n){if(e&&e.o){if(q.has(e))return;q.add(e),Te.c.push(()=>{q.delete(e)}),e.o(t)}}function te(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Ne(e){e&&e.c()}function we(e,t,l){const{fragment:n,after_update:o}=e.$$;n&&n.m(t,l),D(()=>{const r=e.$$.on_mount.map(de).filter(ce);e.$$.on_destroy?e.$$.on_destroy.push(...r):A(r),e.$$.on_mount=[]}),o.forEach(D)}function pe(e,t){const l=e.$$;l.fragment!==null&&(Le(l.after_update),A(l.on_destroy),l.fragment&&l.fragment.d(t),l.on_destroy=l.fragment=null,l.ctx=[])}function Be(e,t){e.$$.dirty[0]===-1&&($.push(e),Ie(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function me(e,t,l,n,o,r,s=null,i=[-1]){const m=B;N(e);const d=e.$$={fragment:null,ctx:[],props:r,update:T,not_equal:o,bound:Y(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(m?m.$$.context:[])),callbacks:Y(),dirty:i,skip_bound:!1,root:t.target||m.$$.root};s&&s(d.root);let g=!1;if(d.ctx=l?l(e,t.props||{},(u,c,..._)=>{const f=_.length?_[0]:c;return d.ctx&&o(d.ctx[u],d.ctx[u]=f)&&(!d.skip_bound&&d.bound[u]&&d.bound[u](f),g&&Be(e,u)),c}):[],d.update(),g=!0,A(d.before_update),d.fragment=n?n(d.ctx):!1,t.target){if(t.hydrate){const u=Se(t.target);d.fragment&&d.fragment.l(u),u.forEach(O)}else d.fragment&&d.fragment.c();t.intro&&fe(e.$$.fragment),we(e,t.target,t.anchor),ue()}N(m)}class he{constructor(){W(this,"$$");W(this,"$$set")}$destroy(){pe(this,1),this.$destroy=T}$on(t,l){if(!ce(l))return T;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(l),()=>{const o=n.indexOf(l);o!==-1&&n.splice(o,1)}}$set(t){this.$$set&&!be(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Pe="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Pe);const le=async(e="",t="")=>{let l=null;const n=await fetch(`${t}/models`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",...e&&{authorization:`Bearer ${e}`}}}).then(async r=>{if(!r.ok)throw await r.json();return r.json()}).catch(r=>{var s;return l=`OpenAI: ${((s=r==null?void 0:r.error)==null?void 0:s.message)??"Network Problem"}`,[]});if(l)throw l;const o=Array.isArray(n)?n:(n==null?void 0:n.data)??null;return o&&o.map(r=>({id:r.id,name:r.name??r.id,url:t,custom_info:r.custom_info})).sort((r,s)=>r.name.localeCompare(s.name))},ne=async(e,t)=>{let l=await Promise.all([le(e,`${t}/ollama/v1`).catch(n=>(console.log(n),null)),le(e,`${t}/openai/api`).catch(n=>(console.log(n),null))]);return l=l.filter(n=>n).reduce((n,o,r,s)=>n.concat(o),[]),console.log(l),l},He=async(e="",t={},l="http://localhost:8080")=>{const n=new AbortController;let o=null;const r=await fetch(`${l}/chat/completions`,{signal:n.signal,method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t)}).catch(s=>(console.log(s),o=s,null));if(o)throw o;return[r,n]},ze=e=>{let t="";return new TransformStream({transform(l,n){t+=l;const o=t.split(e);o.slice(0,-1).forEach(r=>n.enqueue(r)),t=o[o.length-1]},flush(l){t&&l.enqueue(t)}})};function oe(e,t,l){const n=e.slice();return n[6]=t[l],n}function re(e){let t,l,n;function o(i,m){return i[1]?qe:Ke}let r=o(e),s=r(e);return{c(){t=p("div"),s.c(),a(t,"class","tlwd-fixed tlwd-top-0 tlwd-right-0 tlwd-left-0 tlwd-bottom-0 tlwd-w-full tlwd-min-h-screen tlwd-h-screen tlwd-flex tlwd-justify-center tlwd-z-[9999999999] tlwd-overflow-hidden tlwd-overscroll-contain")},m(i,m){j(i,t,m),s.m(t,null),l||(n=S(t,"mousedown",e[15]),l=!0)},p(i,m){r===(r=o(i))&&s?s.p(i,m):(s.d(1),s=r(i),s&&(s.c(),s.m(t,null)))},d(i){i&&O(t),s.d(),l=!1,n()}}}function Ke(e){let t,l,n,o,r,s,i,m,d,g,u,c,_,f;return{c(){t=p("div"),l=p("div"),n=p("form"),o=p("div"),r=p("div"),r.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path></svg>`,s=C(),i=p("input"),m=C(),d=p("div"),g=p("div"),g.textContent="Press âŒ˜Space+Shift to toggle",u=C(),c=p("button"),c.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-3"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path></svg>`,a(r,"class","tlwd-flex tlwd-items-center"),a(i,"id","open-webui-search-input"),a(i,"placeholder","Search Open WebUI"),a(i,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),a(i,"autocomplete","one-time-code"),a(o,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full"),a(g,"class","tlwd-text-right tlwd-text-[0.7rem] tlwd-p-0 tlwd-m-0 tlwd-text-neutral-300 tlwd-h-fit"),a(c,"class","tlwd-h-fit tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),a(c,"type","button"),a(d,"class","tlwd-flex tlwd-justify-end tlwd-gap-1 tlwd-items-center"),a(n,"class","tlwd-text-gray-200 tlwd-w-full tlwd-p-0 tlwd-m-0"),a(n,"autocomplete","off"),a(l,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-2.5 tlwd-px-3.5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation"),a(t,"class","tlwd-m-auto tlwd-max-w-xl tlwd-w-full tlwd-pb-32")},m(k,E){j(k,t,E),w(t,l),w(l,n),w(n,o),w(o,r),w(o,s),w(o,i),M(i,e[4]),w(n,m),w(n,d),w(d,g),w(d,u),w(d,c),_||(f=[S(i,"input",e[13]),S(c,"click",e[14]),S(n,"submit",e[7]),S(n,"mousedown",Ve)],_=!0)},p(k,E){E&16&&i.value!==k[4]&&M(i,k[4])},d(k){k&&O(t),_=!1,A(f)}}}function qe(e){let t,l,n,o,r,s,i,m,d,g,u,c,_,f,k,E,P,b=e[5]&&e[5].length>0&&se(e);return{c(){t=p("div"),l=p("div"),n=p("form"),o=p("div"),r=p("div"),r.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"></path></svg>`,s=C(),i=p("input"),m=C(),d=p("div"),g=p("div"),g.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"></path></svg>`,u=C(),c=p("input"),_=C(),f=p("button"),f.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"></path></svg>`,k=C(),b&&b.c(),a(r,"class","tlwd-flex tlwd-items-center"),a(i,"id","open-webui-url-input"),a(i,"placeholder","Open WebUI URL"),a(i,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),a(i,"autocomplete","one-time-code"),i.required=!0,a(o,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full"),a(g,"class","tlwd-flex tlwd-items-center"),a(c,"placeholder","Open WebUI API Key"),a(c,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),a(c,"autocomplete","one-time-code"),c.required=!0,a(f,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),a(f,"type","button"),a(d,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mt-2"),a(n,"class","tlwd-text-gray-200 tlwd-w-full tlwd-p-0 tlwd-m-0"),a(n,"autocomplete","off"),a(l,"class","tlwd-w-full tlwd-flex tlwd-flex-col tlwd-justify-between tlwd-py-2.5 tlwd-px-3.5 tlwd-rounded-2xl tlwd-outline tlwd-outline-1 tlwd-outline-gray-850 tlwd-backdrop-blur-3xl tlwd-bg-gray-850/70 shadow-4xl modal-animation"),a(t,"class","tlwd-m-auto tlwd-max-w-sm tlwd-w-full tlwd-pb-32")},m(x,h){j(x,t,h),w(t,l),w(l,n),w(n,o),w(o,r),w(o,s),w(o,i),M(i,e[2]),w(n,m),w(n,d),w(d,g),w(d,u),w(d,c),M(c,e[3]),w(d,_),w(d,f),w(n,k),b&&b.m(n,null),E||(P=[S(i,"input",e[9]),S(c,"input",e[10]),S(f,"click",e[11]),S(n,"submit",e[8]),S(n,"mousedown",Ue)],E=!0)},p(x,h){h&4&&i.value!==x[2]&&M(i,x[2]),h&8&&c.value!==x[3]&&M(c,x[3]),x[5]&&x[5].length>0?b?b.p(x,h):(b=se(x),b.c(),b.m(n,null)):b&&(b.d(1),b=null)},d(x){x&&O(t),b&&b.d(),E=!1,A(P)}}}function se(e){let t,l,n,o,r,s,i,m,d,g=te(e[5]),u=[];for(let c=0;c<g.length;c+=1)u[c]=ie(oe(e,g,c));return{c(){t=p("div"),l=p("div"),l.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"></path></svg>`,n=C(),o=p("select"),r=p("option"),r.textContent="Select a model";for(let c=0;c<u.length;c+=1)u[c].c();s=C(),i=p("button"),i.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="${2.5}" stroke="currentColor" class="tlwd-size-5"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path></svg>`,a(l,"class","tlwd-flex tlwd-items-center"),r.__value="",M(r,r.__value),a(o,"id","open-webui-model-input"),a(o,"class","tlwd-p-0 tlwd-m-0 tlwd-text-xl tlwd-w-full tlwd-font-medium tlwd-bg-transparent tlwd-border-none placeholder:tlwd-text-gray-500 tlwd-text-neutral-100 tlwd-outline-none"),a(o,"autocomplete","off"),o.required=!0,e[6]===void 0&&D(()=>e[12].call(o)),a(i,"class","tlwd-flex tlwd-items-center tlwd-bg-transparent tlwd-text-neutral-100 tlwd-cursor-pointer tlwd-p-0 tlwd-m-0 tlwd-outline-none tlwd-border-none"),a(i,"type","submit"),a(t,"class","tlwd-flex tlwd-items-center tlwd-gap-2 tlwd-w-full tlwd-mt-2")},m(c,_){j(c,t,_),w(t,l),w(t,n),w(t,o),w(o,r);for(let f=0;f<u.length;f+=1)u[f]&&u[f].m(o,null);Q(o,e[6],!0),w(t,s),w(t,i),m||(d=S(o,"change",e[12]),m=!0)},p(c,_){if(_&32){g=te(c[5]);let f;for(f=0;f<g.length;f+=1){const k=oe(c,g,f);u[f]?u[f].p(k,_):(u[f]=ie(k),u[f].c(),u[f].m(o,null))}for(;f<u.length;f+=1)u[f].d(1);u.length=g.length}_&96&&Q(o,c[6])},d(c){c&&O(t),ke(u,c),m=!1,d()}}}function ie(e){let t,l=(e[6].name??e[6].id)+"",n,o;return{c(){t=p("option"),n=J(l),t.__value=o=e[6].id,M(t,t.__value)},m(r,s){j(r,t,s),w(t,n)},p(r,s){s&32&&l!==(l=(r[6].name??r[6].id)+"")&&Ce(n,l),s&32&&o!==(o=r[6].id)&&(t.__value=o,M(t,t.__value))},d(r){r&&O(t)}}}function De(e){let t,l=e[0]&&re(e);return{c(){l&&l.c(),t=xe()},m(n,o){l&&l.m(n,o),j(n,t,o)},p(n,[o]){n[0]?l?l.p(n,o):(l=re(n),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null)},i:T,o:T,d(n){n&&O(t),l&&l.d(n)}}}const Ue=e=>{e.stopPropagation()},Ve=e=>{e.stopPropagation()};function Re(e,t,l){let n=!1,o=!0,r="",s="",i="",m="",d=[];const g=()=>{console.log("resetConfig");try{chrome.storage.local.clear().then(()=>{console.log("Value is cleared")})}catch(h){console.log(h),localStorage.setItem("url",""),localStorage.setItem("key",""),localStorage.setItem("model","")}l(2,r=""),l(3,s=""),l(6,i=""),l(1,o=!0)},u=h=>{h.preventDefault(),window.open(`${r}/?q=${encodeURIComponent(m)}&models=${i}`,"_blank"),l(4,m=""),l(0,n=!1)},c=h=>{h.preventDefault();try{chrome.storage.local.set({url:r,key:s,model:i}).then(()=>{console.log("Value is set")})}catch(H){console.log(H),localStorage.setItem("url",r),localStorage.setItem("key",s),localStorage.setItem("model",i)}l(1,o=!1)};Oe(async()=>{let h=null;try{h=await chrome.storage.local.get()}catch(y){console.log(y)}h&&(l(2,r=h.url??""),l(3,s=h.key??""),l(6,i=h.model??""),h.url&&h.key&&h.model&&(l(5,d=await ne(h.key,h.url)),l(1,o=!1)));const H=async y=>{var G;if(n&&y.shiftKey&&y.key==="Escape"?g():y.key==="Escape"&&l(0,n=!1),y.key===" "&&(y.metaKey||y.ctrlKey)&&(y.shiftKey||y.altKey)){y.preventDefault();try{const v=await chrome.runtime.sendMessage({action:"getSelection"});((v==null?void 0:v.data)??!1)&&l(4,m=v.data)}catch(v){console.log("catch",v)}l(0,n=!n),setTimeout(()=>{const v=document.getElementById("open-webui-search-input");v&&v.focus()},0)}if(s!==""&&r!==""&&y.key==="Enter"&&(y.metaKey||y.ctrlKey)&&(y.shiftKey||y.altKey)){y.preventDefault();try{const v=await chrome.runtime.sendMessage({action:"getSelection"});if((v==null?void 0:v.data)??!1){await chrome.runtime.sendMessage({action:"writeText",text:`
`});const[U,Je]=await He(s,{model:i,messages:[{role:"system",content:"You are a helpful assistant."},{role:"user",content:v.data}],stream:!0},(G=d.find(V=>V.id===i))==null?void 0:G.url);if(U&&U.ok){const V=U.body.pipeThrough(new TextDecoderStream).pipeThrough(ze(`
`)).getReader();for(;;){const{value:ge,done:_e}=await V.read();if(_e)break;try{let R=ge.split(`
`);for(const z of R)if(z!=="")if(console.log(z),z==="data: [DONE]")console.log("DONE");else{let K=JSON.parse(z.replace(/^data: /,""));console.log(K),"request_id"in K?console.log(K.request_id):await chrome.runtime.sendMessage({action:"writeText",text:K.choices[0].delta.content??""})}}catch(R){console.log(R)}}}}}catch(v){console.log(v)}}};return document.addEventListener("keydown",H,{capture:!0}),()=>document.removeEventListener("keydown",H)});function _(){r=this.value,l(2,r)}function f(){s=this.value,l(3,s)}const k=async()=>{r.endsWith("/")&&l(2,r=r.slice(0,-1)),l(5,d=await ne(s,r))};function E(){i=Ee(this),l(6,i),l(5,d)}function P(){m=this.value,l(4,m)}return[n,o,r,s,m,d,i,u,c,_,f,k,E,P,()=>{l(1,o=!0)},()=>{l(0,n=!1)}]}class We extends he{constructor(t){super(),me(this,t,Re,De,ae,{})}}function Ze(e){let t,l,n;return l=new We({}),{c(){t=p("div"),Ne(l.$$.fragment),a(t,"class","extension-container")},m(o,r){j(o,t,r),we(l,t,null),n=!0},p:T,i(o){n||(fe(l.$$.fragment,o),n=!0)},o(o){Ae(l.$$.fragment,o),n=!1},d(o){o&&O(t),pe(l)}}}class Fe extends he{constructor(t){super(),me(this,t,null,Ze,ae,{})}}new Fe({target:document.getElementById("extension-app")});
